<view class="page">
  <!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œæ  -->
  <view class="header-row">
    <view class="header">{{sessionName}} - ä½œä¸š</view>
    <view class="header-actions">
      <button bindtap="toggleFilter" size="mini" class="filter-toggle-btn {{showFilter ? 'active' : ''}}">
        <text class="filter-icon">âš™</text>
        ç­›é€‰
      </button>
      <button bindtap="onPullDownRefresh" size="mini" class="refresh-btn">åˆ·æ–°</button>
    </view>
  </view>

  <!-- å¿«æ·ç­›é€‰æ  -->
  <view class="quick-filter-bar">
    <view class="quick-filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²æˆªæ­¢', 'è¿›è¡Œä¸­']}}"
              value="{{filterForm.isExpired === 'yes' ? 1 : (filterForm.isExpired === 'no' ? 2 : 0)}}"
              data-field="isExpired" bindchange="onQuickFilterChange">
        <view class="quick-filter-picker {{filterForm.isExpired ? 'active' : ''}}">
          <text class="quick-filter-label">æˆªæ­¢ï¼š</text>
          <text class="quick-filter-value">{{filterForm.isExpired === 'yes' ? 'å·²æˆªæ­¢' : (filterForm.isExpired === 'no' ? 'è¿›è¡Œä¸­' : 'å…¨éƒ¨')}}</text>
          <text class="quick-filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view class="quick-filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²æäº¤', 'æœªæäº¤']}}"
              value="{{filterForm.isSubmitted === 'yes' ? 1 : (filterForm.isSubmitted === 'no' ? 2 : 0)}}"
              data-field="isSubmitted" bindchange="onQuickFilterChange">
        <view class="quick-filter-picker {{filterForm.isSubmitted ? 'active' : ''}}">
          <text class="quick-filter-label">æäº¤ï¼š</text>
          <text class="quick-filter-value">{{filterForm.isSubmitted === 'yes' ? 'å·²æäº¤' : (filterForm.isSubmitted === 'no' ? 'æœªæäº¤' : 'å…¨éƒ¨')}}</text>
          <text class="quick-filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view class="quick-filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²æ‰¹æ”¹', 'æœªæ‰¹æ”¹']}}"
              value="{{filterForm.isGraded === 'yes' ? 1 : (filterForm.isGraded === 'no' ? 2 : 0)}}"
              data-field="isGraded" bindchange="onQuickFilterChange">
        <view class="quick-filter-picker {{filterForm.isGraded ? 'active' : ''}}">
          <text class="quick-filter-label">æ‰¹æ”¹ï¼š</text>
          <text class="quick-filter-value">{{filterForm.isGraded === 'yes' ? 'å·²æ‰¹æ”¹' : (filterForm.isGraded === 'no' ? 'æœªæ‰¹æ”¹' : 'å…¨éƒ¨')}}</text>
          <text class="quick-filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- é«˜çº§ç­›é€‰é¢æ¿ -->
  <view wx:if="{{showFilter}}" class="filter-panel">
    <view class="filter-title">
      <text>é«˜çº§ç­›é€‰</text>
      <text class="filter-count">å…± {{homeworkList.length}} é¡¹</text>
    </view>

    <view class="filter-section">
      <view class="filter-row">
        <text class="filter-label">è¯¾ç¨‹</text>
        <picker mode="selector" range="{{['å…¨éƒ¨'].concat(courseOptions)}}"
                value="{{filterForm.courseName ? courseOptions.indexOf(filterForm.courseName) + 1 : 0}}"
                data-field="courseName" bindchange="onFilterInput">
          <view class="filter-picker">
            <text>{{filterForm.courseName || 'å…¨éƒ¨'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>

      <view class="filter-row">
        <text class="filter-label">è¯¾å ‚</text>
        <picker mode="selector" range="{{['å…¨éƒ¨'].concat(classOptions)}}"
                value="{{filterForm.className ? classOptions.indexOf(filterForm.className) + 1 : 0}}"
                data-field="className" bindchange="onFilterInput">
          <view class="filter-picker">
            <text>{{filterForm.className || 'å…¨éƒ¨'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>

      <view class="filter-row">
        <text class="filter-label">ä½œä¸š</text>
        <picker mode="selector" range="{{['å…¨éƒ¨'].concat(titleOptions)}}"
                value="{{filterForm.title ? titleOptions.indexOf(filterForm.title) + 1 : 0}}"
                data-field="title" bindchange="onFilterInput">
          <view class="filter-picker">
            <text>{{filterForm.title || 'å…¨éƒ¨'}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </picker>
      </view>
    </view>

    <view class="filter-section">
      <view class="filter-row">
        <text class="filter-label">å‘å¸ƒæ—¶é—´</text>
        <view class="filter-date-range">
          <picker mode="date" value="{{filterForm.publishStartDate}}"
                  data-field="publishStartDate" bindchange="onFilterInput">
            <view class="filter-date-picker">{{filterForm.publishStartDate || 'å¼€å§‹'}}</view>
          </picker>
          <text class="filter-separator">è‡³</text>
          <picker mode="date" value="{{filterForm.publishEndDate}}"
                  data-field="publishEndDate" bindchange="onFilterInput">
            <view class="filter-date-picker">{{filterForm.publishEndDate || 'ç»“æŸ'}}</view>
          </picker>
        </view>
      </view>

      <view class="filter-row">
        <text class="filter-label">æˆªæ­¢æ—¶é—´</text>
        <view class="filter-date-range">
          <picker mode="date" value="{{filterForm.deadlineStartDate}}"
                  data-field="deadlineStartDate" bindchange="onFilterInput">
            <view class="filter-date-picker">{{filterForm.deadlineStartDate || 'å¼€å§‹'}}</view>
          </picker>
          <text class="filter-separator">è‡³</text>
          <picker mode="date" value="{{filterForm.deadlineEndDate}}"
                  data-field="deadlineEndDate" bindchange="onFilterInput">
            <view class="filter-date-picker">{{filterForm.deadlineEndDate || 'ç»“æŸ'}}</view>
          </picker>
        </view>
      </view>
    </view>

    <view class="filter-buttons">
      <button class="filter-btn reset-btn" size="mini" bindtap="resetFilter">é‡ç½®ç­›é€‰</button>
      <button class="filter-btn apply-btn" size="mini" type="primary" bindtap="applyFilter">åº”ç”¨ç­›é€‰</button>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä½œä¸šåˆ—è¡¨ -->
  <block wx:elif="{{!isEmpty}}">
    <view
      wx:for="{{homeworkList}}"
      wx:key="homeworkId"
      class="homework-item"
      data-id="{{item.homeworkId}}"
      bindtap="goToDetail">

      <!-- ä½œä¸šæ ‡é¢˜ -->
      <view class="homework-title">{{item.title}}</view>

      <!-- å¤šçŠ¶æ€æ ‡ç­¾è¡Œ -->
      <view class="status-tags">
        <!-- æˆªæ­¢çŠ¶æ€ -->
        <view class="status-tag {{item.isExpired ? 'tag-expired' : 'tag-ongoing'}}">
          {{item.isExpired ? 'å·²æˆªæ­¢' : 'è¿›è¡Œä¸­'}}
        </view>

        <!-- æäº¤çŠ¶æ€ -->
        <view class="status-tag {{item.isSubmitted ? 'tag-submitted' : 'tag-not-submitted'}}">
          {{item.isSubmitted ? 'å·²æäº¤' : 'æœªæäº¤'}}
        </view>

        <!-- æ‰¹æ”¹çŠ¶æ€ï¼ˆä»…åœ¨å·²æäº¤æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{item.isSubmitted}}" class="status-tag {{item.isGraded ? 'tag-graded' : 'tag-pending'}}">
          {{item.isGraded ? 'å·²æ‰¹æ”¹' : 'å¾…æ‰¹æ”¹'}}
        </view>

        <!-- åˆ†æ•°ï¼ˆä»…åœ¨å·²æ‰¹æ”¹æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{item.isGraded && item.submission.score !== null && item.submission.score !== undefined}}" class="status-tag tag-score">
          {{item.submission.score}}åˆ†
        </view>
      </view>

      <!-- ä½œä¸šä¿¡æ¯ -->
      <view class="homework-info">
        <view class="info-row">
          <text class="label">è¯¾ç¨‹ï¼š</text>
          <text class="value">{{item.courseName || 'æœªçŸ¥'}}</text>
        </view>
        <view class="info-row">
          <text class="label">æˆªæ­¢æ—¶é—´ï¼š</text>
          <text class="value {{item.isExpired ? 'text-expired' : ''}}">{{item.deadline || 'æ— æˆªæ­¢æ—¶é—´'}}</text>
        </view>
        <view class="info-row">
          <text class="label">æ€»åˆ†ï¼š</text>
          <text class="value text-score">{{item.totalScore || 100}}åˆ†</text>
        </view>
        <view wx:if="{{item.isGraded && item.submission.remark}}" class="info-row">
          <text class="label">æ•™å¸ˆè¯„è¯­ï¼š</text>
          <text class="value text-remark">{{item.submission.remark}}</text>
        </view>
      </view>

      <!-- ç®­å¤´æŒ‡ç¤º -->
      <view class="arrow-icon">â€º</view>
    </view>
  </block>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty">
    <view class="empty-icon">ğŸ“</view>
    <text>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä½œä¸š</text>
    <button wx:if="{{hasActiveFilter}}" class="clear-filter-btn" size="mini" bindtap="resetFilter">æ¸…é™¤ç­›é€‰</button>
  </view>
</view>
