<view class="page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header-row">
    <view class="header">{{sessionName}} - ä½œä¸š</view>
    <view class="header-actions">
      <button bindtap="onPullDownRefresh" size="mini" class="refresh-btn">åˆ·æ–°</button>
    </view>
  </view>

  <!-- ç­›é€‰æ  - åªä¿ç•™çŠ¶æ€ç­›é€‰ -->
  <view class="filter-bar">
    <view class="filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'è¿›è¡Œä¸­', 'å·²æˆªæ­¢']}}"
              value="{{filterForm.isExpired === 'no' ? 1 : (filterForm.isExpired === 'yes' ? 2 : 0)}}"
              data-field="isExpired" bindchange="onFilterChange">
        <view class="filter-picker {{filterForm.isExpired ? 'active' : ''}}">
          <text class="filter-text">{{filterForm.isExpired === 'yes' ? 'å·²æˆªæ­¢' : (filterForm.isExpired === 'no' ? 'è¿›è¡Œä¸­' : 'æˆªæ­¢çŠ¶æ€')}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view class="filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²æäº¤', 'æœªæäº¤']}}"
              value="{{filterForm.isSubmitted === 'yes' ? 1 : (filterForm.isSubmitted === 'no' ? 2 : 0)}}"
              data-field="isSubmitted" bindchange="onFilterChange">
        <view class="filter-picker {{filterForm.isSubmitted ? 'active' : ''}}">
          <text class="filter-text">{{filterForm.isSubmitted === 'yes' ? 'å·²æäº¤' : (filterForm.isSubmitted === 'no' ? 'æœªæäº¤' : 'æäº¤çŠ¶æ€')}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view class="filter-item">
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²æ‰¹æ”¹', 'æœªæ‰¹æ”¹']}}"
              value="{{filterForm.isGraded === 'yes' ? 1 : (filterForm.isGraded === 'no' ? 2 : 0)}}"
              data-field="isGraded" bindchange="onFilterChange">
        <view class="filter-picker {{filterForm.isGraded ? 'active' : ''}}">
          <text class="filter-text">{{filterForm.isGraded === 'yes' ? 'å·²æ‰¹æ”¹' : (filterForm.isGraded === 'no' ? 'æœªæ‰¹æ”¹' : 'æ‰¹æ”¹çŠ¶æ€')}}</text>
          <text class="filter-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <view wx:if="{{hasActiveFilter}}" class="filter-reset" bindtap="resetFilter">
      <text>é‡ç½®</text>
    </view>
  </view>

  <!-- ä½œä¸šæ•°é‡ -->
  <view class="homework-count">å…± {{homeworkList.length}} é¡¹ä½œä¸š</view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä½œä¸šåˆ—è¡¨ -->
  <block wx:elif="{{!isEmpty}}">
    <view
      wx:for="{{homeworkList}}"
      wx:key="homeworkId"
      class="homework-item"
      data-id="{{item.homeworkId}}"
      bindtap="goToDetail">

      <!-- ä½œä¸šæ ‡é¢˜ -->
      <view class="homework-title">{{item.title}}</view>

      <!-- å¤šçŠ¶æ€æ ‡ç­¾è¡Œ -->
      <view class="status-tags">
        <!-- æˆªæ­¢çŠ¶æ€ -->
        <view class="status-tag {{item.isExpired ? 'tag-expired' : 'tag-ongoing'}}">
          {{item.isExpired ? 'å·²æˆªæ­¢' : 'è¿›è¡Œä¸­'}}
        </view>

        <!-- æäº¤çŠ¶æ€ -->
        <view class="status-tag {{item.isSubmitted ? 'tag-submitted' : 'tag-not-submitted'}}">
          {{item.isSubmitted ? 'å·²æäº¤' : 'æœªæäº¤'}}
        </view>

        <!-- æ‰¹æ”¹çŠ¶æ€ï¼ˆä»…åœ¨å·²æäº¤æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{item.isSubmitted}}" class="status-tag {{item.isGraded ? 'tag-graded' : 'tag-pending'}}">
          {{item.isGraded ? 'å·²æ‰¹æ”¹' : 'å¾…æ‰¹æ”¹'}}
        </view>

        <!-- åˆ†æ•°ï¼ˆä»…åœ¨å·²æ‰¹æ”¹æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{item.isGraded && item.submission.score !== null && item.submission.score !== undefined}}" class="status-tag tag-score">
          {{item.submission.score}}åˆ†
        </view>
      </view>

      <!-- ä½œä¸šä¿¡æ¯ -->
      <view class="homework-info">
        <view class="info-row">
          <text class="label">è¯¾ç¨‹ï¼š</text>
          <text class="value">{{item.courseName || 'æœªçŸ¥'}}</text>
        </view>
        <view class="info-row">
          <text class="label">æˆªæ­¢æ—¶é—´ï¼š</text>
          <text class="value {{item.isExpired ? 'text-expired' : ''}}">{{item.deadline || 'æ— æˆªæ­¢æ—¶é—´'}}</text>
        </view>
        <view class="info-row">
          <text class="label">æ€»åˆ†ï¼š</text>
          <text class="value text-score">{{item.totalScore || 100}}åˆ†</text>
        </view>
        <view wx:if="{{item.isGraded && item.submission.remark}}" class="info-row">
          <text class="label">æ•™å¸ˆè¯„è¯­ï¼š</text>
          <text class="value text-remark">{{item.submission.remark}}</text>
        </view>
      </view>

      <!-- ç®­å¤´æŒ‡ç¤º -->
      <view class="arrow-icon">â€º</view>
    </view>
  </block>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:else class="empty">
    <view class="empty-icon">ğŸ“</view>
    <text>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä½œä¸š</text>
    <button wx:if="{{hasActiveFilter}}" class="clear-filter-btn" size="mini" bindtap="resetFilter">æ¸…é™¤ç­›é€‰</button>
  </view>
</view>
