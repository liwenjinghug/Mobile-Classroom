<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-box">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- ä½œä¸šä¿¡æ¯å¡ç‰‡ -->
    <view class="homework-info">
      <view class="info-header">
        <text class="title">{{homework.title}}</text>
      </view>

      <!-- å¤šçŠ¶æ€æ ‡ç­¾è¡Œ -->
      <view class="status-tags">
        <!-- æˆªæ­¢çŠ¶æ€ -->
        <view class="status-tag {{isExpired ? 'tag-expired' : 'tag-ongoing'}}">
          {{isExpired ? 'å·²æˆªæ­¢' : 'è¿›è¡Œä¸­'}}
        </view>

        <!-- æäº¤çŠ¶æ€ -->
        <view class="status-tag {{submission ? 'tag-submitted' : 'tag-not-submitted'}}">
          {{submission ? 'å·²æäº¤' : 'æœªæäº¤'}}
        </view>

        <!-- æ‰¹æ”¹çŠ¶æ€ï¼ˆä»…åœ¨å·²æäº¤æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{submission}}" class="status-tag {{status === 'å·²æ‰¹æ”¹' ? 'tag-graded' : 'tag-pending'}}">
          {{status === 'å·²æ‰¹æ”¹' ? 'å·²æ‰¹æ”¹' : 'å¾…æ‰¹æ”¹'}}
        </view>

        <!-- åˆ†æ•°ï¼ˆä»…åœ¨å·²æ‰¹æ”¹æ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{status === 'å·²æ‰¹æ”¹' && submission.score !== null && submission.score !== undefined}}" class="status-tag tag-score">
          {{submission.score}}åˆ†
        </view>
      </view>

      <view class="info-item">
        <text class="label">è¯¾ç¨‹ï¼š</text>
        <text class="value">{{homework.courseName}}</text>
      </view>

      <view class="info-item">
        <text class="label">è¯¾å ‚ï¼š</text>
        <text class="value">{{homework.className}}</text>
      </view>

      <view class="info-item">
        <text class="label">æˆªæ­¢æ—¶é—´ï¼š</text>
        <text class="value {{isExpired ? 'expired-text' : ''}}">{{homework.deadline}}</text>
      </view>

      <view class="info-item">
        <text class="label">æ€»åˆ†ï¼š</text>
        <text class="value score">{{homework.totalScore || 100}}åˆ†</text>
      </view>

      <!-- å·²æ‰¹æ”¹æ—¶æ˜¾ç¤ºæˆç»©ä¿¡æ¯ -->
      <view wx:if="{{status === 'å·²æ‰¹æ”¹'}}" class="grade-info">
        <view class="info-item">
          <text class="label">æˆ‘çš„å¾—åˆ†ï¼š</text>
          <text class="value grade-score">{{submission.score}}åˆ†</text>
        </view>
        <view wx:if="{{submission.remark}}" class="info-item">
          <text class="label">æ•™å¸ˆè¯„è¯­ï¼š</text>
          <text class="value remark">{{submission.remark}}</text>
        </view>
      </view>
    </view>

    <!-- ä½œä¸šå†…å®¹ -->
    <view class="homework-content">
      <view class="content-title">ä½œä¸šå†…å®¹</view>
      <view class="content-text">{{homework.content || 'æš‚æ— æè¿°'}}</view>

      <!-- é™„ä»¶ -->
      <view wx:if="{{homework.attachments}}" class="attachments">
        <view class="attachment-title">ğŸ“ é™„ä»¶</view>
        <text class="attachment-text">{{homework.attachments}}</text>
      </view>
    </view>

    <!-- ç­”é¢˜åŒºåŸŸ -->
    <view class="answer-section" wx:if="{{status !== 'å·²æ‰¹æ”¹'}}">
      <view class="section-title">æˆ‘çš„ç­”æ¡ˆ</view>

      <textarea
        class="answer-input"
        placeholder="è¯·è¾“å…¥ä½ çš„ç­”æ¡ˆ..."
        value="{{answer}}"
        bindinput="onAnswerInput"
        disabled="{{isExpired && !submission}}"
        maxlength="5000"
      />

      <view class="answer-footer">
        <text class="char-count">{{answer.length}}/5000</text>
      </view>

      <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
      <view class="file-section">
        <view class="file-header">
          <text class="file-title">ğŸ“ é™„ä»¶</text>
          <button
            wx:if="{{status !== 'å·²æ‰¹æ”¹' && uploadedFiles.length < 5}}"
            class="upload-btn"
            size="mini"
            bindtap="chooseFile"
            disabled="{{isExpired}}">
            é€‰æ‹©æ–‡ä»¶
          </button>
        </view>

        <!-- æ–‡ä»¶åˆ—è¡¨ -->
        <view wx:if="{{uploadedFiles.length > 0}}" class="file-list">
          <view
            wx:for="{{uploadedFiles}}"
            wx:key="index"
            class="file-item">
            <view class="file-info" data-url="{{item.url}}" bindtap="previewFile">
              <text class="file-icon">ğŸ“„</text>
              <text class="file-name">{{item.name}}</text>
              <text wx:if="{{item.sizeText}}" class="file-size">{{item.sizeText}}</text>
            </view>
            <view
              wx:if="{{status !== 'å·²æ‰¹æ”¹'}}"
              class="file-delete"
              data-index="{{index}}"
              bindtap="deleteFile">
              âœ•
            </view>
          </view>
        </view>

        <view wx:else class="file-empty">
          <text class="empty-tip">æš‚æ— é™„ä»¶</text>
        </view>
      </view>
    </view>

    <!-- å·²æäº¤çš„ç­”æ¡ˆï¼ˆåªè¯»ï¼‰ -->
    <view class="submitted-answer" wx:if="{{submission && status !== 'å·²æ‰¹æ”¹'}}">
      <view class="section-title">å·²æäº¤å†…å®¹</view>

      <!-- ç­”æ¡ˆæ–‡æœ¬ -->
      <view wx:if="{{answer}}" class="submitted-section">
        <text class="submitted-label">ç­”æ¡ˆæ–‡æœ¬ï¼š</text>
        <view class="submitted-text">{{answer}}</view>
      </view>

      <!-- é™„ä»¶åˆ—è¡¨ -->
      <view wx:if="{{uploadedFiles.length > 0}}" class="submitted-section">
        <text class="submitted-label">å·²æäº¤é™„ä»¶ï¼š</text>
        <view class="file-list">
          <view
            wx:for="{{uploadedFiles}}"
            wx:key="index"
            class="file-item">
            <view class="file-info" data-url="{{item.url}}" bindtap="previewFile">
              <text class="file-icon">ğŸ“„</text>
              <text class="file-name">{{item.name}}</text>
              <text wx:if="{{item.sizeText}}" class="file-size">{{item.sizeText}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="submit-time">æäº¤æ—¶é—´ï¼š{{submission.submitTime}}</view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button
        wx:if="{{status !== 'å·²æ‰¹æ”¹' && !isExpired}}"
        class="btn-submit"
        bindtap="submitHomework"
        disabled="{{submitting}}">
        {{submitting ? 'æäº¤ä¸­...' : (status === 'å·²æäº¤' ? 'é‡æ–°æäº¤' : 'æäº¤ä½œä¸š')}}
      </button>

      <button
        wx:if="{{status === 'å·²æ‰¹æ”¹'}}"
        class="btn-view-grade"
        bindtap="viewGrade">
        æŸ¥çœ‹æˆç»©ä¸è¯„è¯­
      </button>

      <view wx:if="{{isExpired && status === 'æœªæäº¤'}}" class="expired-tip">
        âš ï¸ ä½œä¸šå·²æˆªæ­¢ï¼Œæ— æ³•æäº¤
      </view>
    </view>
  </view>
</view>

